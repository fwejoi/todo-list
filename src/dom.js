import { format, parseISO, differenceInDays } from 'date-fns';//ËΩªÈáèÁ∫ßÁöÑ JavaScript Êó•ÊúüÂ§ÑÁêÜÂ∫ì
import projects from './projects';//ÂØºÂÖ•È°πÁõÆÁÆ°ÁêÜÊ®°Âùó
import tasks from './tasks';//ÂØºÂÖ•‰ªªÂä°ÁÆ°ÁêÜÊ®°Âùó


const dom = (() => {
  //Ëé∑ÂèñdomÂÖÉÁ¥†
  const toggleMenuIcon = document.querySelector('.toggle-menu');
  const sidebarMenu = document.querySelector('#sidebar-menu');
  const modal = document.querySelector('#modal');
  const form = modal.querySelector('#form');
  const modalTitle = modal.querySelector('#modal-title');
  const modalTitleError = modal.querySelector('.modal-title-error');
  const mainContent = document.querySelector('#main');
  const mainTitleIcon = document.querySelector('.main-title-icon');
  const mainTitleText = document.querySelector('.main-title-text');
  const projectsLinksDiv = document.querySelector('.projects-links-div');
  const addTaskButton = document.querySelector('.add-task');
  const tasksCount = document.querySelector('.tasks-count');
  const tasksList = document.querySelector('.tasks-list');
  const taskDescription = modal.querySelector('.task-description');
  const taskDueDate = modal.querySelector('#dueDate');
  const taskPrioritySelection = modal.querySelector('.task-priority');

  //ÂìçÂ∫îÂºèËèúÂçï
  function responsiveMenu() {
    if (window.innerWidth <= 1000) {
      toggleMenuIcon.classList.remove('active');

      // Â∞Ü‰æßËæπÊ†èÁöÑÊòæÁ§∫Áä∂ÊÄÅÊîπ‰∏∫‰∏çÂèØËßÅ
      sidebarMenu.classList.remove('show-sidebar');
      sidebarMenu.classList.add('hide-sidebar');
      sidebarMenu.classList.add('add-z-index');

      // Êâ©Â±ï‰∏ªÂÜÖÂÆπ
      mainContent.classList.remove('contract-main');
      mainContent.classList.add('expand-main');

    } else {
      // ÊòæÁ§∫‰æßËæπÊ†è‰ΩøÂÖ∂Á®çÂæÆÈÄèÊòé
      sidebarMenu.classList.remove('hide-sidebar');
      sidebarMenu.classList.add('show-sidebar');
      sidebarMenu.classList.remove('add-z-index');

      // Êî∂Áº©‰∏ªÂÜÖÂÆπ‰ΩøÂÖ∂‰∏çÈÄèÊòé
      mainContent.classList.remove('expand-main');
      mainContent.classList.add('contract-main');
      mainContent.classList.remove('inactive-main');
    }
  }

  //ÂàáÊç¢ËèúÂçï
  function toggleMenu() {
    toggleMenuIcon.classList.toggle('active');

    // ÊòæÁ§∫‰æßËæπÊ†è‰ΩøÂÖ∂‰∏ªÂÜÖÂÆπÁ®çÂæÆÈÄèÊòé
    if (sidebarMenu.classList.contains('hide-sidebar')) {
      sidebarMenu.classList.remove('hide-sidebar');
      sidebarMenu.classList.add('show-sidebar');
      mainContent.classList.add('inactive-main');

      // ÈöêËóè‰æßËæπÊ†è‰ΩøÂÖ∂‰∏ªÂÜÖÂÆπ‰∏çÈÄèÊòé
    } else if (sidebarMenu.classList.contains('show-sidebar')) {
      sidebarMenu.classList.remove('show-sidebar');
      sidebarMenu.classList.add('hide-sidebar');
      mainContent.classList.remove('inactive-main');
    }
  }

  // ÊçÆÁ¥¢ÂºïËÆæÁΩÆËèúÂçïÂõæÊ†áÂíåÊñáÊú¨ÔºåÂπ∂Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò„ÄÇ
  function showMainTitle(index) {
    const allMenuIcons = document.querySelectorAll('.menu-link-icon');//ÈÄâÊã©ÊâÄÊúâËèúÂçïÂõæÊ†áÂÖÉÁ¥†
    const menuIcon = allMenuIcons[index].getAttribute('data-icon');//Ëé∑ÂèñÊåáÂÆöÁ¥¢ÂºïÁöÑËèúÂçïÂõæÊ†áÁöÑdata-iconÂÄº
    const menuTexts = document.querySelectorAll('.menu-link-text');//ÈÄâÊã©ÊâÄÊúâËèúÂçïÊñáÊú¨ÂÖÉÁ¥†

    //ËÆæÁΩÆ‰∏ªÈ¢òÂõæÊ†áÂíåÊñáÊú¨
    mainTitleIcon.classList.add(
      'fal',//Ê∑ªÂä†font AwesomÊ†∑ÂºèÁ±ª
      'fa-fw',//Ê∑ªÂä†Âõ∫ÂÆöÂÆΩÂ∫¶Ê†∑ÂºèÁ±ª
      'main-title-icon',//Ê∑ªÂä†Ëá™ÂÆö‰πâÊ†∑ÂºèÁ±ª
      'padding-right',//Ê∑ªÂä†Âè≥‰æßÂÜÖËæπË∑ùÊ†∑ÂºèÁ±ª
      menuIcon//Ê∑ªÂä†‰ªéËèúÂçïÂõæÊ†áËé∑ÂèñÁöÑÁ±ªÂêç
    );
    //ËÆæÁΩÆ‰∏ªÊ†áÈ¢òÊñáÊú¨‰∏∫ÂØπÂ∫îËèúÂçïÊñáÊú¨
    mainTitleText.textContent = menuTexts[index].textContent;
    document.title = `ToDo - ${mainTitleText.textContent}`;//Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
  }

  //Ê†πÊçÆÁõÆÊ†áÂÖÉÁ¥†ÁöÑÁ±ªÂûãÊõ¥Êîπ‰∏ªÊ†áÈ¢òÔºåÊîØÊåÅËèúÂçïÂíåÈ°πÁõÆÁöÑ‰∏çÂêåÊÉÖÂÜµ„ÄÇ
  function changeMainTitle(target, index) {
    mainTitleIcon.className = '';//Ê∏ÖÁ©∫‰∏ªÈ¢òÂõæÊ†áÁ±ªÂêç

    // ‰ªéËèúÂçïÊõ¥Êîπ‰ªªÂä°Ê†áÈ¢ò
    if (
      target.classList.contains('menu-link') ||//Â¶ÇÊûúÁõÆÊ†áÊòØËèúÂçïÈìæÊé•
      target.classList.contains('menu-link-icon') ||//ÊàñËèúÂçïÂõæÊ†á
      target.classList.contains('menu-link-text')//ÊàñËèúÂçïÊñáÊú¨
    ) {
      showMainTitle(index);
    }

    // TITLE OF TASKS FROM PROJECTS
    if (
      target.classList.contains('project-link') ||
      target.classList.contains('project-icon') ||
      target.classList.contains('project-text') ||
      target.classList.contains('delete-project') ||
      target.classList.contains('edit-project') ||
      target.classList.contains('project-icon-and-text-div') ||
      target.classList.contains('project-default-icons-div')
    ) {
      const projectIcon = projects.projectsList[index].icon;

      mainTitleIcon.classList.add(
        'fal',
        'fa-fw',
        'main-title-icon',
        'padding-right',
        projectIcon
      );
      mainTitleText.textContent = projects.projectsList[index].title;
      document.title = `ToDo - ${mainTitleText.textContent}`;
    }
  }

  //Êü•Áúã‰ªªÂä°‰ø°ÊÅØÁöÑÂáΩÊï∞
  function watchTaskInfo(projectIndex, taskIndex) {
    //Ëé∑Âèñ‰ªªÂä°‰ø°ÊÅØÁöÑdomÂÖÉÁ¥†
    const infoTaskTitle = document.querySelector('.info-task-title');
    const infoTaskDescription = document.querySelector('.info-task-description');
    const infoTaskDueDate = document.querySelector('.info-task-due-date');
    const infoTaskPriority = document.querySelector('.info-task-priority');
    const infoTaskProject = document.querySelector('.info-task-project');

    // ËÆæÁΩÆ‰ªªÂä°Ê†áÈ¢ò
    infoTaskTitle.textContent =
      projects.projectsList[projectIndex].tasks[taskIndex].title;

    // ËÆæÁΩÆ‰ªªÂä°ÊèèËø∞
    infoTaskDescription.textContent =
      projects.projectsList[projectIndex].tasks[taskIndex].description;

    // ËÆæÁΩÆ‰ªªÂä°Êà™Ëá≥Êó•Êúü
    infoTaskDueDate.textContent =
      projects.projectsList[projectIndex].tasks[taskIndex].date;

    // ËÆæÁΩÆ‰ªªÂä°‰ºòÂÖàÁ∫ß
    if (
      projects.projectsList[projectIndex].tasks[taskIndex].priority === 'low'
    ) {
      infoTaskPriority.textContent = 'I can do it later or never at all.. üò¥';
    } else if (
      projects.projectsList[projectIndex].tasks[taskIndex].priority === 'medium'
    ) {
      infoTaskPriority.textContent = 'I stay somewhere between relaxation and focus üòÖ';
    } else if (
      projects.projectsList[projectIndex].tasks[taskIndex].priority === 'high'
    ) {
      infoTaskPriority.textContent = 'I must do it - sooner or later! üò≤';
    } else {
      infoTaskPriority.textContent = '';
    }

    // ËÆæÁΩÆ‰ªªÂä°ÊâÄÂ±ûÈ°πÁõÆ
    infoTaskProject.textContent = projects.projectsList[projectIndex].title;
  }

  //Êìç‰ΩúÊ®°ÊÄÅÊ°ÜÁöÑÂáΩÊï∞
  function manipulateModal(modalState, modalTask, modalAction, projectIndex, taskIndex) {
    //Ëé∑ÂèñÊ®°ÊÄÅÊ°ÜÂÜÖÈÉ®ÂÖÉÁ¥†
    const modalHeader = modal.querySelector('.modal-header');
    const modalMainTitle = modal.querySelector('.modal-main-title');
    const modalTaskButton = modal.querySelector('.modal-task-button');
    const projectDeletionText = modal.querySelector('.project-deletion-text');
    const taskDeletionText = modal.querySelector('.task-deletion-text');
    const taskInfoDiv = modal.querySelector('.info-div');
    const confirmButton = modal.querySelector('.confirm-modal');
    const cancelButton = modal.querySelector('.cancel-modal');

    //ÈáçÁΩÆÊ®°ÊÄÅÊ°ÜÊ†∑Âºè
    modalHeader.classList.remove('deletion-modal-header');
    form.reset();
    form.classList.remove('hide');
    taskInfoDiv.classList.add('hide');
    modalTitleError.classList.add('hide');
    projectDeletionText.classList.add('hide');
    taskDeletionText.classList.add('hide');
    cancelButton.classList.remove('cancel-deletion');
    confirmButton.classList.remove('confirm-deletion', 'hide');

    //ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
    if (modalState === 'show') {
      const modalIconsDiv = modal.querySelector('.radio-form');
      const modalTasksDiv = modal.querySelector('.modal-tasks-div');

      modal.classList.remove('hide');
      modalMainTitle.textContent = modalTask;
      modalTaskButton.textContent = modalAction;
      modalIconsDiv.classList.remove('hide');
      modalIconsDiv.classList.add('show');
      modalTasksDiv.classList.add('hide');

      // Â¶ÇÊûúÊòØÁºñËæëÈ°πÁõÆ
      if (modalTask === 'Edit Project') {
        const allProjectIcons = modal.querySelectorAll('.icon');
        const projectIcon = projects.projectsList[projectIndex].icon;

        // ÊòæÁ§∫ÂèØÁºñËæëÁöÑÈ°πÁõÆÊ†áÈ¢ò
        modalTitle.value = projects.projectsList[projectIndex].title;

        // ÈÄâÊã©ÂèØÁºñËæëÁöÑÈ°πÁõÆÂõæÊ†á
        for (let i = 0; i < allProjectIcons.length; i += 1) {
          if (allProjectIcons[i].value === projectIcon) {
            allProjectIcons[i].checked = true;
          }
        }

      // Â¶ÇÊûúÊòØÊ∑ªÂä†ÊàñÁºñËæë‰ªªÂä°
      } else if (modalTask === 'Add Task'||
          modalTask === 'Edit Task'
      ) {
        modalIconsDiv.classList.remove('show');
        modalIconsDiv.classList.add('hide');
        modalTasksDiv.classList.remove('hide');

        //Â¶ÇÊûúÊòØÁºñËæë‰ªªÂä°
        if (modalTask === 'Edit Task') {
          modalTitle.value = projects.projectsList[projectIndex].tasks[taskIndex].title;
          taskDescription.value = projects.projectsList[projectIndex].tasks[taskIndex].description;
          taskDueDate.value = projects.projectsList[projectIndex].tasks[taskIndex].date;
          taskPrioritySelection.value = projects.projectsList[projectIndex].tasks[taskIndex].priority;
        }

        // Â¶ÇÊûúÊòØÊü•Áúã‰ªªÂä°‰ø°ÊÅØ
      } else if (modalTask === 'Task Info') {
        form.classList.add('hide');
        confirmButton.classList.add('hide');
        taskInfoDiv.classList.remove('hide');
        watchTaskInfo(projectIndex, taskIndex);
      }
    }

    // Âà†Èô§Ê®°ÊÄÅÊ°ÜÁöÑÂÜÖÂÆπ
    if (modalAction === 'Delete') {
      modalHeader.classList.add('deletion-modal-header');
      form.classList.add('hide');
      cancelButton.classList.add('cancel-deletion');
      confirmButton.classList.add('confirm-deletion');

      // È°πÁõÆÂà†Èô§
      if (modalTask === 'Delete Project') {
        const projectDeletionTitle = document.querySelector('.project-deletion-title');

        projectDeletionText.classList.remove('hide');
        projectDeletionTitle.textContent = projects.projectsList[projectIndex].title;

        // ‰ªªÂä°Âà†Èô§
      } else if (modalTask === 'Delete Task') {
        const taskDeletionTitle = document.querySelector('.task-deletion-title');

        taskDeletionText.classList.remove('hide');
        taskDeletionTitle.textContent =
          projects.projectsList[projectIndex].tasks[taskIndex].title;
      }
    }

    // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
    if (modalState === 'close') {
      modal.classList.add('hide');
    }
  }

  //ÊòæÁ§∫‰ªªÂä°ÁöÑÂáΩÊï∞
  function showTasks(menuTitle, projectIndexStart, projectIndexEnd) {
    const todayDate = format(new Date(), 'yyyy-MM-dd');//Ëé∑Âèñ‰ªäÂ§©Êó•Êúü
    let tasksNumber = 0;//‰ªªÂä°Êï∞ÈáèÂàùÂßãÂåñ

    tasksCount.textContent = 0;//ÂàùÂßãÂåñ‰ªªÂä°ËÆ°Êï∞
    tasksList.textContent = '';//‰ªªÂä°ÂàóË°®Ê∏ÖÁ©∫

    // ÁîüÊàê‰ªªÂä°ÂàóË°®
    for (let i = projectIndexStart; i < projectIndexEnd; i += 1) {
      for (let j = 0; j < projects.projectsList[i].tasks.length; j += 1) {
        const taskDiv = document.createElement('div');
        const taskIconAndTextDiv = document.createElement('div');
        const taskIcon = document.createElement('i');
        const taskText = document.createElement('p');
        const taskInfo = document.createElement('div');
        const taskDate = document.createElement('p');
        const taskEditIcon = document.createElement('i');
        const taskTrashIcon = document.createElement('i');
        const taskInfoIcon = document.createElement('i');

        // Â¶ÇÊûúÁÇπÂáª‰∫ÜÁ∫¢ËçØËèúÂçïÈìæÊé•ÔºåËøáÁï•‰∏çÈáçË¶ÅÁöÑ‰ªªÂä°
        if (
          menuTitle === 'important' &&
          projects.projectsList[i].tasks[j].priority !== 'high'
        ) {
          continue; // Â¶ÇÊûú‰ªªÂä°‰∏çÊòØÈáçË¶ÅÁöÑÔºåË∑≥Ëøá

          // Â¶ÇÊûúÁÇπÂáª‰∫Ü‰ªäÂ§©ËèúÂçïÈìæÊé•
        } else if (menuTitle === 'today') {

          if (projects.projectsList[i].tasks[j].date !== todayDate
          ) {
            continue; // Ë∑≥Ëøá‰∏çÊòØ‰ªäÂ§©Êà™Ê≠¢ÁöÑ‰ªªÂä°
          }

          // Â¶ÇÊûúÁÇπÂáª‰∫ÜÊú¨Âë®ËèúÂçïÈìæÊé•
        } else if (menuTitle === 'week') {
          const dateOfToday = parseISO(todayDate);
          const dateOfTask = parseISO(projects.projectsList[i].tasks[j].date)

          if (!(differenceInDays(dateOfTask, dateOfToday) <= 7 &&
             differenceInDays(dateOfTask, dateOfToday) >= 0
          )) {
           continue; // ‰ªªÂä°‰∏çÊòØÊú¨Âë®Âà∞ÊúüÁöÑÔºåË∑≥Ëøá
          }

          // Â¶ÇÊûúÁÇπÂáª‰∫ÜÂ∑≤ÂÆåÊàêÈìæÊé•
        } else if (menuTitle === 'completed' &&
          projects.projectsList[i].tasks[j].completed !== true
        ) {
          continue; // Ë∑≥ËøáËøòÊ≤°ÂÆåÊàêÁöÑ‰ªªÂä°
        }

        // ÊòæÁ§∫‰ªªÂä°Êï∞Èáè
        tasksNumber += 1;
        tasksCount.textContent = tasksNumber;

        // ËÆæÁΩÆ‰ªªÂä°ÁöÑÊñáÊú¨„ÄÅ‰ºòÂÖàÁ∫ßÂíåÂÖ∂div
        taskDiv.classList.add('task-div', 'hover-element');
        taskIconAndTextDiv.classList.add('flex');
        taskDiv.setAttribute('data-project-index', i);
        taskDiv.setAttribute('data-task-index', j);

        //Ê†πÊçÆ‰ªªÂä°‰ºòÂÖàÁ∫ßËÆæÁΩÆÂõæÊ†áÊ†∑Âºè
        if (projects.projectsList[i].tasks[j].priority === 'low') {
          taskIcon.classList.add('low-priority');
        } else if (projects.projectsList[i].tasks[j].priority === 'medium') {
          taskIcon.classList.add('mid-priority');
        } else if (projects.projectsList[i].tasks[j].priority === 'high') {
          taskIcon.classList.add('high-priority');
        } else {
          taskIcon.classList.add('fal', 'padding-right');
        }
        taskIcon.setAttribute('data-project-index', i);
        taskIcon.setAttribute('data-task-index', j);

        //ËÆæÁΩÆ‰ªªÂä°ÊñáÊú¨
        taskText.classList.add('task-text');
        taskText.textContent = projects.projectsList[i].tasks[j].title;
        taskText.setAttribute('data-project-index', i);
        taskText.setAttribute('data-task-index', j);

        // ËÆæÁΩÆ‰ªªÂä°‰ø°ÊÅØdiv
        taskInfo.classList.add('flex');

        // ËÆæÁΩÆ‰ªªÂä°Âà∞ÊúüÊó•Êúü
        taskDate.classList.add('due-date', 'padding-right');
        if (projects.projectsList[i].tasks[j].date !== undefined) {
          taskDate.textContent = projects.projectsList[i].tasks[j].date;
        } else {
          taskDate.textContent = '';
        }

        // ËÆæÁΩÆ‰ªªÂä°ÁºñËæëÂõæÊ†á
        taskEditIcon.classList.add(
          'fal',
          'fa-edit',
          'edit-task',
          'task-icon',
          'scale-element',
          'padding-right'
        );
        taskEditIcon.setAttribute('data-project-index', i);
        taskEditIcon.setAttribute('data-task-index', j);

        // ËÆæÁΩÆ‰ªªÂä°Âà†Èô§ÂõæÊ†á
        taskTrashIcon.classList.add(
          'fal',
          'fa-trash-alt',
          'delete-task',
          'task-icon',
          'scale-element',
          'padding-right'
        );
        taskTrashIcon.setAttribute('data-project-index', i);
        taskTrashIcon.setAttribute('data-task-index', j);

        // ËÆæÁΩÆ‰ªªÂä°‰ø°ÊÅØÂõæÊ†á
        taskInfoIcon.classList.add(
          'fal',
          'task-icon',
          'scale-element',
          'fa-info-circle'
        );
        taskInfoIcon.setAttribute('data-project-index', i);
        taskInfoIcon.setAttribute('data-task-index', j);

        // Â∞ÜÂÖÉÁ¥†ÈôÑÂä†Âà∞‰ªªÂä°div
        taskIconAndTextDiv.appendChild(taskIcon);
        taskIconAndTextDiv.appendChild(taskText);
        taskInfo.appendChild(taskDate);
        taskInfo.appendChild(taskEditIcon);
        taskInfo.appendChild(taskTrashIcon);
        taskInfo.appendChild(taskInfoIcon);
        taskDiv.appendChild(taskIconAndTextDiv);
        taskDiv.appendChild(taskInfo);
        tasksList.appendChild(taskDiv);

        // ËÆæÁΩÆ‰ªªÂä°ÂÆåÊàêÁä∂ÊÄÅ
        if (projects.projectsList[i].tasks[j].completed === false) {
          taskText.classList.remove('task-done-text');
          taskIcon.classList.add(
            'fal',
            'fa-circle',
            'padding-right'
          );
        } else {
          taskText.classList.add('task-done-text');
          taskIcon.classList.add(
            'fal',
            'fa-check-circle',
            'padding-right'
          );
        }
      }
    }
    //ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
    manipulateModal('close');
  }

  //Ëé∑Âèñ‰ªªÂä°ÁöÑÂáΩÊï∞
  function getTasks(menuTitle, projectIndex) {
    let projectIndexStart;//È°πÁõÆÂºÄÂßãÁ¥¢Âºï
    let projectIndexEnd;//È°πÁõÆÁªìÊùüÁ¥¢Âºï

    // Â∞ÜÂ∏¶Êúâ‰ªªÂä°ÁöÑÈ°πÁõÆ‰øùÂ≠òÂà∞Êú¨Âú∞
    localStorage.setItem('projects', JSON.stringify(projects.projectsList));

    // Â¶ÇÊûúÁÇπÂáª‰∫ÜÈ°πÁõÆÈìæÊé•
    if (menuTitle === 'project') {
      //Á°Æ‰øùÂú®Áî®Êà∑ÁÇπÂáªÊüê‰∏™È°πÁõÆÊó∂Ôºå‰ªÖÊòæÁ§∫ËØ•È°πÁõÆ‰∏ãÁöÑ‰ªªÂä°ÔºåËÄå‰∏çÊòØÊòæÁ§∫ÊâÄÊúâÈ°πÁõÆÁöÑ‰ªªÂä°„ÄÇ
      projectIndexStart = projectIndex;
      projectIndexEnd = projectIndex + 1;

      // Â¶ÇÊûúÈ°πÁõÆÊ≤°Áî®‰ªª‰Ωï‰ªªÂä°
      if (projects.projectsList[projectIndex].tasks.length === 0) {
        tasksCount.textContent = 0;
      }

      // Â¶ÇÊûúÁÇπÂáª‰∫ÜËèúÂçïÈìæÊé•
    } else {
      projectIndexStart = 0;//‰ªéÁ¨¨‰∏Ä‰∏™‰ªªÂä°ÂºÄÂßã
      projectIndexEnd = projects.projectsList.length;//Âà∞È°πÁõÆÂàóË°®ÁöÑÊúÄÂêé‰∏Ä‰∏™È°πÁõÆ
    }
    showTasks(menuTitle, projectIndexStart, projectIndexEnd);//ÊòæÁ§∫‰ªªÂä°
  }

  function selectLink(target, index, action) {
    //Ëé∑ÂèñÊâÄÊúâÈìæÊé•ÂÖÉÁ¥†
    const allLinks = document.querySelectorAll('.link');
    //Ëé∑ÂèñÊâÄÊúâÈ°πÁõÆÈìæÊé•
    const allProjectsLinks = document.querySelectorAll('.project-link');
    //Ëé∑ÂèñÁÇπÂáªÁõÆÊ†áÁöÑÊ†áÈ¢òÂ±ûÊÄß
    const menuTitle = target.getAttribute('data-title');

    //ÈªòËÆ§ÈöêËóèÊ∑ªÂä†‰ªªÂä°ÊåâÈíÆ
    addTaskButton.classList.add('hide'); // By default 'Add Task' button is hidden

    //ÁßªÈô§ÊâÄÊúâÈìæÊé•ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
    allLinks.forEach((link) => {
      link.classList.remove('selected-link');
    });

    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÈìæÊé•ÔºàËèúÂçïÊàñÈ°πÁõÆÔºâ
    if (target.classList.contains('link')) {
      //ÁªôÂΩìÂâçÈìæÊé•Ê∑ªÂä†ÈÄâ‰∏≠Áä∂ÊÄÅ
      target.classList.add('selected-link');

      // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÁºñËæëÈ°πÁõÆÈìæÊé•
      if (action === 'edit') {
        allProjectsLinks[index].classList.add('selected-link'); // ‰øùÊåÅÁºñËæëÂêéÁöÑÈ°πÁõÆÈìæÊé•Ë¢´ÈÄâ‰∏≠
      }

      // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØËèúÂçïÈìæÊé•ÁöÑÂõæÊ†áÊàñÊñáÊú¨
    } else if (
      target.classList.contains('menu-link-icon') ||
      target.classList.contains('menu-link-text')
    ) {
      target.parentElement.classList.add('selected-link');//Â∞ÜÁà∂ÂÖÉÁ¥†ÈìæÊé•Ê†áËÆ∞‰∏∫ÈÄâ‰∏≠
    }

    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊüê‰∏™È°πÁõÆÈìæÊé•
    if (target.classList.contains('project')) {
      addTaskButton.classList.remove('hide'); // ÊòæÁ§∫Ê∑ªÂä†‰ªªÂä°ÊåâÈíÆ
      getTasks('project', index);//Ëé∑ÂèñËØ•È°πÁõÆ‰ªªÂä°

      // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÈ°πÁõÆÁöÑÂõæÊ†á„ÄÅÊñáÊú¨ÊàñÁºñËæë/Âà†Èô§ÂõæÊ†á
      if (
        target.classList.contains('project-icon') ||
        target.classList.contains('project-text') ||
        target.classList.contains('edit-project') ||
        target.classList.contains('delete-project')
      ) {
        target.parentElement.parentElement.classList.add('selected-link');//Â∞ÜÈ°πÁõÆÁöÑÁà∂ÈìæÊé•Ê†áËÆ∞‰∏∫ÈÄâ‰∏≠

        // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÈ°πÁõÆÂÖÉÁ¥†ÁöÑdiv
      } else if (
        target.classList.contains('project-icon-and-text-div') ||
        target.classList.contains('project-default-icons-div')
      ) {
        target.parentElement.classList.add('selected-link');//Ê†áËÆ∞‰∏∫ÈÄâ‰∏≠
      }
    }

    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØËèúÂçïÈìæÊé•
    if (
      target.classList.contains('menu-link') ||
      target.classList.contains('menu-link-icon') ||
      target.classList.contains('menu-link-text')
    ) {
      getTasks(menuTitle);//Ê†πÊçÆËèúÂçïÊ†áÈ¢òËé∑Âèñ‰ªªÂä°
    }
  }

  //Á°Æ‰øùÁî®Êà∑Âú®Ê®°ÊÄÅÊ°Ü‰∏≠ËøõË°åÁöÑÊìç‰Ωú‰ºöÊ≠£Á°ÆÂèçÊò†Âà∞Êï∞ÊçÆÊ®°ÂûãÂíåÁî®Êà∑ÁïåÈù¢‰∏ä
  function validateModal(modalAction, projectIndex, taskIndex, clickedLink) {
    const { projectFormIcon } = document.forms.form;//Ëé∑ÂèñË°®Âçï‰∏≠ÁöÑÈ°πÁõÆÂõæÊ†á
    const projectDomIcon = projectFormIcon.value;//Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÈ°πÁõÆÂõæÊ†áÂÄº
    const projectIconsDiv = modal.querySelector('.radio-form');//Ëé∑ÂèñÂõæÊ†áÈÄâÊã©Âå∫Âüü
    const modalTitleText = modalTitle.value;//Ëé∑ÂèñÊ®°ÊÄÅÊ°ÜÊ†áÈ¢òÊñáÊú¨
    const projectDeletionText = document.querySelector('.project-deletion-text');//Ëé∑ÂèñÈ°πÁõÆÂà†Èô§ÊèêÁ§∫ÊñáÊú¨
    const menuLinkAll = document.querySelector('.link:first-child');//Ëé∑ÂèñËèúÂçïÁ¨¨‰∏Ä‰∏™ÈìæÊé•
    let taskPriority;//Áî®‰∫éÂ≠òÂÇ®‰ªªÂä°‰ºòÂÖàÁ∫ß

    // Ê£ÄÊü•Ê®°ÊÄÅÊ°ÜÊ†áÈ¢òÊòØÂê¶‰∏∫Á©∫
    if (!form.classList.contains('hide') &&
        modalTitleText === ''
    ) {
      modalTitleError.classList.remove('hide');//ÊòæÁ§∫Ê†áÈ¢òÈîôËØØ
      modalTitleError.classList.add('show');//ÈîôËØØ‰ø°ÊÅØÂèØËßÅ

      // Ê∑ªÂä†È°πÁõÆÂà∞Êï∞ÁªÑ
    } else if (
      modalAction === 'add' &&
      projectIconsDiv.classList.contains('show')
    ) {
      projects.addProject(projectDomIcon, modalTitleText);//Ê∑ªÂä†È°πÁõÆ
      mainContent.classList.remove('inactive-main');//ÊòæÁ§∫‰∏ªÂÜÖÂÆπ

      // ‰ΩøÊñ∞Ê∑ªÂä†È°πÁõÆ‰øùÊåÅÈÄâ‰∏≠Áä∂ÊÄÅ
      const lastProject = projectsLinksDiv.lastChild;//Ëé∑ÂèñÊúÄÂêéÊ∑ªÂä†ÁöÑÈ°πÁõÆ
      const lastProjectIndex = projectsLinksDiv.lastChild.getAttribute('data-link-index');//Ëé∑ÂèñÂÖ∂Á¥¢Âºï

      selectLink(lastProject, lastProjectIndex);//ÈÄâÊã©ËØ•È°πÁõÆ
      changeMainTitle(lastProject, lastProjectIndex);//Êõ¥Êñ∞‰∏ªÊ†áÈ¢ò

    } // ÁºñËæëÈ°πÁõÆ
      else if (modalAction === 'edit' &&
        projectIconsDiv.classList.contains('show')
    ) {
      const allProjectsLinks = document.querySelectorAll('.project-link');//Ëé∑ÂèñÊâÄÊúâÈ°πÁõÆÈìæÊé•
      const editedProject = allProjectsLinks[projectIndex];//Ëé∑ÂèñË¢´ÁºñËæëÁöÑÈ°πÁõÆ

      projects.editProject(projectDomIcon, modalTitleText, projectIndex, clickedLink);//ÁºñËæëÈ°πÁõÆ
      changeMainTitle(editedProject, projectIndex);//Êõ¥Êñ∞‰∏ªÊ†áÈ¢ò

      // Âà†Èô§È°πÁõÆ
    } else if (
      modalAction === 'delete' &&
      !projectDeletionText.classList.contains('hide')
    ) {
      projects.deleteProject(projectIndex);//‰ªéÈ°πÁõÆÊï∞ÁªÑ‰∏≠Âà†Èô§ÂÖÉÁ¥†
      menuLinkAll.classList.add('selected-link');//ÈÄâÊã©Á¨¨‰∏Ä‰∏™ËèúÂçïÂÖÉÁ¥†
      addTaskButton.classList.add('hide');//ÈöêËóèÊ∑ªÂä†‰ªªÂä°ÊåâÈíÆ

      // Ê∑ªÂä†‰ªªÂä°Âà∞Êï∞ÁªÑ
    } else if (
      modalAction === 'add' &&
      projectIconsDiv.classList.contains('hide')
    ) {

      // Ê£ÄÊü•‰ªªÂä°‰ºòÂÖàÁ∫ß
      if (taskPrioritySelection.value === 'low') {
        taskPriority = 'low';
      } else if (taskPrioritySelection.value === 'medium') {
        taskPriority = 'medium';
      } else if (taskPrioritySelection.value === 'high') {
        taskPriority = 'high';
      } else {
        taskPriority = '';
      }

      //Ê∑ªÂä†‰ªªÂä°
      tasks.addTask(
        modalTitleText,
        taskDescription.value,
        taskDueDate.value,
        taskPriority,
        projectIndex
      );

      // ÁºñËæëÊàñÂà†Èô§‰ªªÂä°
    } else if (modalAction === 'edit' ||
      modalAction === 'delete') {
      let menuTitle;

      // Â¶ÇÊûú‰ªªÂä°‰ªéËèúÈìæÊé•‰∏≠ÁºñËæëÊàñÂà†Èô§
      if (clickedLink.classList.contains('menu-link')) {
        menuTitle = clickedLink.getAttribute('data-title');//Ëé∑ÂèñËèúÂçïÊ†áÈ¢ò

        // Â¶ÇÊûú‰ªªÂä°‰ªéÈ°πÁõÆÈìæÊé•‰∏≠ÁºñËæëÊàñÂà†Èô§
      } else if (clickedLink.classList.contains('project-link')) {
        menuTitle = 'project';//ËÆæÁΩÆ‰∏∫È°πÁõÆ
      }

      // ÁºñËæë‰ªªÂä°
      if (modalAction === 'edit') {
        const taskNewTitle = modalTitle.value;//Ëé∑ÂèñÊñ∞ÁöÑ‰ªªÂä°Ê†áÈ¢ò
        const taskNewDescription = taskDescription.value;//Ëé∑ÂèñÊñ∞ÁöÑ‰ªªÂä°ÊèèËø∞
        const taskNewDate = taskDueDate.value;//Ëé∑ÂèñÊñ∞ÁöÑ‰ªªÂä°Êà™Ê≠¢Êó•Êúü
        const taskNewPriority = taskPrioritySelection.value;//Ëé∑ÂèñÊñ∞ÁöÑ‰ªªÂä°‰ºòÂÖàÁ∫ß

        //ÁºñËæë‰ªªÂä°
        tasks.editTask(
          taskNewTitle,
          taskNewDescription,
          taskNewDate,
          taskNewPriority,
          projectIndex,
          taskIndex
        );

        // Âà†Èô§‰ªªÂä°
      } else if (modalAction === 'delete') {
        tasks.deleteTask(projectIndex, taskIndex);//‰ªé‰ªªÂä°Êï∞ÁªÑ‰∏≠Âà†Èô§‰ªªÂä°
      }
      getTasks(menuTitle, projectIndex);//Ê†πÊçÆËèúÂçïÊ†áÈ¢òËé∑Âèñ‰ªªÂä°
    }
  }

  //Âú®Áî®Êà∑ÁïåÈù¢‰∏äÊòæÁ§∫È°πÁõÆÂàóË°®ÔºåÂπ∂Êõ¥Êñ∞È°πÁõÆÊï∞Èáè„ÄÇ
  function showProjects() {
    const projectsCount = document.querySelector('.projects-count');//Ëé∑ÂèñÊòæÁ§∫È°πÁõÆÊï∞ÈáèÁöÑÂÖÉÁ¥†

    // Â∞ÜÈ°πÁõÆÂàóË°®‰øùÂ≠òÂú®Êú¨Âú∞ÂÇ®Â≠ò‰∏≠
    localStorage.setItem('projects', JSON.stringify(projects.projectsList));

    // ÊòæÁ§∫ÂΩìÂâçÈ°πÁõÆÁöÑÊï∞Èáè
    projectsCount.textContent = projects.projectsList.length;//Êõ¥Êñ∞È°πÁõÆÊï∞ÈáèÊñáÊú¨
    projectsLinksDiv.textContent = '';//Ê∏ÖÁ©∫ÂΩìÂâçÈ°πÁõÆÈìæÊé•ÂÆπÂô®

    //ÈÅçÂéÜÈ°πÁõÆÂàóË°®ÔºåÂàõÂª∫È°πÁõÆÈìæÊé•
    for (let i = 0; i < projects.projectsList.length; i += 1) {
            const projectLink = document.createElement('a'); // ÂàõÂª∫È°πÁõÆÈìæÊé•
        const projectIconAndTextDiv = document.createElement('div'); // ÂàõÂª∫ÂåÖÂê´ÂõæÊ†áÂíåÊñáÊú¨ÁöÑ div
        const projectIcon = document.createElement('i'); // ÂàõÂª∫È°πÁõÆÂõæÊ†áÂÖÉÁ¥†
        const projectText = document.createElement('p'); // ÂàõÂª∫È°πÁõÆÊ†áÈ¢òÊñáÊú¨ÂÖÉÁ¥†
        const projectIconsDiv = document.createElement('div'); // ÂàõÂª∫ÂåÖÂê´ÁºñËæëÂíåÂà†Èô§ÂõæÊ†áÁöÑ div
        const projectEditIcon = document.createElement('i'); // ÂàõÂª∫ÁºñËæëÂõæÊ†áÂÖÉÁ¥†
        const projectTrashIcon = document.createElement('i'); // ÂàõÂª∫Âà†Èô§ÂõæÊ†áÂÖÉÁ¥†

      // PROJECT ICON/TEXT AND DEFAULT ICONS DIVS
      projectIconAndTextDiv.classList.add(
        'project-icon-and-text-div',
        'project',
        'select'
      );
      projectIconAndTextDiv.setAttribute('data-link-index', i);
      projectIconsDiv.classList.add(
        'project-default-icons-div',
        'project',
        'select'
      );
      projectIconsDiv.setAttribute('data-link-index', i);

      // PROJECT LINK
      projectLink.classList.add('link', 'project-link', 'project', 'select');
      projectLink.setAttribute('href', '#');
      projectLink.setAttribute('data-link-index', i);

      // PROJECT ICON
      projectIcon.classList.add(
        'fal',
        'fa-fw',
        'project-icon',
        'project',
        'select',
        'padding-right',
        projects.projectsList[i].icon
      );
      projectIcon.setAttribute('data-link-index', i);

      // PROJECT TEXT
      projectText.classList.add('project-text', 'project', 'select');
      projectText.textContent = projects.projectsList[i].title;
      projectText.setAttribute('data-link-index', i);

      // PROJECT DEFAULT ICONS
      projectEditIcon.classList.add(
        'fal',
        'fa-edit',
        'project',
        'project-icon',
        'edit-project',
        'select',
        'scale-element',
        'padding-right'
      );
      projectEditIcon.setAttribute('data-link-index', i);

      projectTrashIcon.classList.add(
        'fal',
        'fa-trash-alt',
        'project',
        'project-icon',
        'delete-project',
        'select',
        'scale-element'
      );
      projectTrashIcon.setAttribute('data-link-index', i);

      // APPENDS
      projectIconsDiv.appendChild(projectEditIcon);
      projectIconsDiv.appendChild(projectTrashIcon);
      projectIconAndTextDiv.appendChild(projectIcon);
      projectIconAndTextDiv.appendChild(projectText);
      projectLink.appendChild(projectIconAndTextDiv);
      projectLink.appendChild(projectIconsDiv);
      projectsLinksDiv.appendChild(projectLink);
    }
    manipulateModal('close');
  }

  return {
    //Ë∞ÉÊï¥‰æßËæπËèúÂçïÁöÑÊ†∑ÂºèÔºå‰ª•ÈÄÇÂ∫îÁ™óÂè£Â§ßÂ∞èÂèòÂåñ„ÄÇ
responsiveMenu,

// ÂàáÊç¢‰æßËæπËèúÂçïÁöÑÊòæÁ§∫ÂíåÈöêËóèÁä∂ÊÄÅ„ÄÇ
toggleMenu,

// ÊòæÁ§∫‰∏ªÊ†áÈ¢òÔºåÊ†πÊçÆ‰º†ÂÖ•ÁöÑÁ¥¢ÂºïÊõ¥Êñ∞Ê†áÈ¢òÂÜÖÂÆπ„ÄÇ
showMainTitle,

// Êõ¥Êîπ‰∏ªÊ†áÈ¢òÔºåÊõ¥Êñ∞ÊòæÁ§∫ÁöÑÊ†áÈ¢òÊñáÊú¨„ÄÇ
changeMainTitle,

// ÊéßÂà∂Ê®°ÊÄÅÊ°ÜÁöÑÊòæÁ§∫ÊàñÂÖ≥Èó≠ÔºåÂπ∂Ê†πÊçÆÈúÄË¶ÅÊõ¥Êñ∞Ê†áÈ¢òÂíåÂÜÖÂÆπ„ÄÇ
manipulateModal,

// ÊòæÁ§∫‰∏éÁâπÂÆöÈ°πÁõÆÁõ∏ÂÖ≥ÁöÑ‰ªªÂä°„ÄÇ
showTasks,

// Ëé∑ÂèñÂπ∂Â±ïÁ§∫ÊåáÂÆöÈ°πÁõÆÊàñÊâÄÊúâÈ°πÁõÆÁöÑ‰ªªÂä°„ÄÇ
getTasks,

// È´ò‰∫ÆÈÄâ‰∏≠ÁöÑÈìæÊé•ÔºåÂπ∂Êõ¥Êñ∞Áõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇ
selectLink,

// È™åËØÅÊ®°ÊÄÅÊ°Ü‰∏≠ÁöÑËæìÂÖ•ÔºåÂπ∂ÊâßË°åÊ∑ªÂä†„ÄÅÁºñËæëÊàñÂà†Èô§È°πÁõÆ/‰ªªÂä°ÁöÑÊìç‰Ωú„ÄÇ
validateModal,

// ÊòæÁ§∫È°πÁõÆÂàóË°®ÔºåÂπ∂Êõ¥Êñ∞È°πÁõÆËÆ°Êï∞„ÄÇ
showProjects

  };
})();

export default dom;
